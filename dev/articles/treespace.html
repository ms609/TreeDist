<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tree space &amp; landscape analysis • TreeDist</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Tree space &amp; landscape analysis">
<meta property="og:description" content="TreeDist">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-156666971-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-156666971-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TreeDist</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.2.1.9200</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Using-TreeDist.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Using-TreeDist.html">Using TreeDist to calculate tree similarity</a>
    </li>
    <li>
      <a href="../articles/treespace.html">Tree space analysis in TreeDist</a>
    </li>
    <li>
      <a href="../articles/using-distances.html">Contextualizing tree distances</a>
    </li>
    <li>
      <a href="../articles/Robinson-Foulds.html">Robinson-Foulds metric</a>
    </li>
    <li>
      <a href="../articles/Generalized-RF.html">Generalized Robinson-Foulds distances</a>
    </li>
    <li>
      <a href="../articles/information.html">Concepts of information</a>
    </li>
    <li>
      <a href="../articles/Tree-distance-interpretation.html">Evaluating tree distance metrics</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ms609/TreeDist">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><link href="treespace_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="treespace_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tree space &amp; landscape analysis</h1>
                        <h4 class="author"><a href="https://smithlabdurham.github.io/">Martin R. Smith</a></h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ms609/TreeDist/blob/master/vignettes/treespace.Rmd"><code>vignettes/treespace.Rmd</code></a></small>
      <div class="hidden name"><code>treespace.Rmd</code></div>

    </div>

    
    
<p>It can be instructive to visualize the distribution of trees in a spatial ‘landscape’. This can be a helpful means to address whether discrete islands of trees exist, or whether analytical runs have converged. Such analysis is relatively simple to conduct, but a few common oversights can mislead interpretation.</p>
<div id="tree-space-analysis-via-user-interface" class="section level2">
<h2 class="hasAnchor">
<a href="#tree-space-analysis-via-user-interface" class="anchor"></a>Tree space analysis via user interface</h2>
<p>You can conduct treespace analysis simply using the Shiny app that comes with the ‘TreeDist’ R package. Simply install <a href="https://www.r-project.org/">R</a> or <a href="https://rstudio.com/">RStudio</a>, then copy the code below into the R command line:</p>
<!--#install.packages('TreeDist')-->
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'devtools'</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">'ms609/TreeDist'</span><span class="op">)</span>
<span class="fu">TreeDist</span><span class="fu">::</span><span class="fu"><a href="../reference/TreeSpace.html">TreeSpace</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<p>This will allow you to conduct and evaluate basic tree space projections from tree lists saved in most common file formats; see an <a href="https://ms609.github.io/TreeDist/reference/TreeSpace.html">outline of the basic functionality</a>. To avoid misinterpreting tree space, it’s worth having a broad idea of what an analysis involves, and some potential pitfalls.</p>
</div>
<div id="avoiding-common-pitfalls-in-tree-space-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#avoiding-common-pitfalls-in-tree-space-analysis" class="anchor"></a>Avoiding common pitfalls in tree space analysis</h2>
<p>Here’s an example analysis of a series of 200 trees from an ordered list. The list corresponds to a mixed-base representation of trees (see <code><a href="https://ms609.github.io/TreeTools/reference/TreeNumber.html">TreeTools::as.TreeNumber</a></code>), so is expected to contain some structure as we jump from one ‘class’ of tree to another. Let’s see whether we can visualize and corroborate this structure.</p>
<p>First we’ll generate the trees, and load some colours with which we might identify them.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ms609.github.io/TreeTools/">'TreeTools'</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">treeNumbers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">220</span><span class="op">)</span>
<span class="va">trees</span> <span class="op">&lt;-</span> <span class="fu">as.phylo</span><span class="op">(</span><span class="va">treeNumbers</span>, <span class="fl">8</span><span class="op">)</span>
<span class="va">spectrum</span> <span class="op">&lt;-</span> <span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridisLite/man/viridis.html">plasma</a></span><span class="op">(</span><span class="fl">220</span><span class="op">)</span>
<span class="va">treeCols</span> <span class="op">&lt;-</span> <span class="va">spectrum</span><span class="op">[</span><span class="va">treeNumbers</span><span class="op">]</span></pre></div>
<div id="using-a-suitable-distance-metric" class="section level3">
<h3 class="hasAnchor">
<a href="#using-a-suitable-distance-metric" class="anchor"></a>Using a suitable distance metric</h3>
<p>Now we need to calculate the distance between each pair of trees in our list. The choice of distance metric is important <span class="citation">(Smith, 2021)</span>. The widely used Robinson–Foulds distance is, unfortunately, unsuitable for tree space analysis. The clustering information distance <span class="citation">(Smith, 2020)</span> is a reliable alternative that is fast to calculate:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ms609.github.io/TreeDist/">'TreeDist'</a></span><span class="op">)</span>
<span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TreeDistance.html">ClusteringInfoDistance</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span></pre></div>
<p>The reader is encouraged to repeat the exercise with other distances:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Robinson-Foulds.html">RobinsonFoulds</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span>
<span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TreeDistance.html">PhylogeneticInfoDistance</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span>
<span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span><span class="op">(</span><span class="fu">Quartet</span><span class="fu">::</span><span class="fu"><a href="https://ms609.github.io/Quartet/reference/SimilarityMetrics.html">QuartetDivergence</a></span><span class="op">(</span>
  <span class="fu">Quartet</span><span class="fu">::</span><span class="fu"><a href="https://ms609.github.io/Quartet/reference/QuartetStatus.html">ManyToManyQuartetAgreement</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span>, similarity <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></pre></div>
</div>
<div id="projecting-distances" class="section level3">
<h3 class="hasAnchor">
<a href="#projecting-distances" class="anchor"></a>Projecting distances</h3>
<p>Then we need to reduce the dimensionality of these distances. We’ll start out with a 12-dimensional projection; if needed, we can always drop higher dimensions.</p>
<p>Principal components analysis is quick and performs very well:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">projection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cmdscale.html">cmdscale</a></span><span class="op">(</span><span class="va">distances</span>, k <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></pre></div>
<p>Alternative projection methods do exist, and sometimes give slightly better projections. <code>isoMDS()</code> performs non-metric multidimensional scaling (MDS) with the Kruskal-1 stress function <span class="citation">(Kruskal, 1964)</span>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">kruskal</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/isoMDS.html">isoMDS</a></span><span class="op">(</span><span class="va">distances</span>, k <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>
<span class="va">projection</span> <span class="op">&lt;-</span> <span class="va">kruskal</span><span class="op">$</span><span class="va">points</span></pre></div>
<p>whereas <code>sammon()</code>, one of many metric MDS methods, uses Sammon’s stress function <span class="citation">(Sammon, 1969)</span>:</p>
<pre><code>sammon &lt;- MASS::sammon(distances, k = 12)
projection &lt;- sammon$points</code></pre>
<p>That’s a good start. It is tempting to plot the first two dimensions arising from this projection and be done:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">projection</span>,
     asp <span class="op">=</span> <span class="fl">1</span>, <span class="co"># Preserve aspect ratio - do not distort distances</span>
     ann <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># Don't label axes: dimensions are meaningless</span>
     col <span class="op">=</span> <span class="va">treeCols</span>, pch <span class="op">=</span> <span class="fl">16</span>
     <span class="op">)</span></pre></div>
<p><img src="treespace_files/figure-html/plot-projection-2d-1.png" width="288" style="display: block; margin: auto;"></p>
</div>
<div id="identifying-clusters" class="section level3">
<h3 class="hasAnchor">
<a href="#identifying-clusters" class="anchor"></a>Identifying clusters</h3>
<p>A quick visual inspection suggests at least two clusters, with the possibility of further subdivision of the brighter trees. But visual inspection can be highly misleading <span class="citation">(Smith, 2021)</span>. We must take a statistical approach. A combination of partitioning around medoids and hierarchical clustering with minimax linkage will typically find a clustering solution that is close to optimal, if one exists <span class="citation">(Smith, 2021)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">possibleClusters</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">10</span>

<span class="va">pamClusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">possibleClusters</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/pam.html">pam</a></span><span class="op">(</span><span class="va">distances</span>, k <span class="op">=</span> <span class="va">k</span><span class="op">)</span><span class="op">)</span>
<span class="va">pamSils</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">pamClusters</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">pamCluster</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html">silhouette</a></span><span class="op">(</span><span class="va">pamCluster</span><span class="op">)</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">bestPam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">pamSils</span><span class="op">)</span>
<span class="va">pamSil</span> <span class="op">&lt;-</span> <span class="va">pamSils</span><span class="op">[</span><span class="va">bestPam</span><span class="op">]</span>
<span class="va">pamCluster</span> <span class="op">&lt;-</span> <span class="va">pamClusters</span><span class="op">[[</span><span class="va">bestPam</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">cluster</span>

<span class="va">hTree</span> <span class="op">&lt;-</span> <span class="fu">protoclust</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/protoclust/man/protoclust.html">protoclust</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span>
<span class="va">hClusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">possibleClusters</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span><span class="op">(</span><span class="va">hTree</span>, k <span class="op">=</span> <span class="va">k</span><span class="op">)</span><span class="op">)</span>
<span class="va">hSils</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">hClusters</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">hCluster</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html">silhouette</a></span><span class="op">(</span><span class="va">hCluster</span>, <span class="va">distances</span><span class="op">)</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>


<span class="va">bestH</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">hSils</span><span class="op">)</span>
<span class="va">hSil</span> <span class="op">&lt;-</span> <span class="va">hSils</span><span class="op">[</span><span class="va">bestH</span><span class="op">]</span>
<span class="va">hCluster</span> <span class="op">&lt;-</span> <span class="va">hClusters</span><span class="op">[[</span><span class="va">bestH</span><span class="op">]</span><span class="op">]</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pamSils</span> <span class="op">~</span> <span class="va">possibleClusters</span>,
     xlab <span class="op">=</span> <span class="st">'Number of clusters'</span>, ylab <span class="op">=</span> <span class="st">'Silhouette coefficient'</span>,
     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pamSils</span>, <span class="va">hSils</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">hSils</span> <span class="op">~</span> <span class="va">possibleClusters</span>, pch <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'topright'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'PAM'</span>, <span class="st">'Hierarchical'</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></pre></div>
<p><img src="treespace_files/figure-html/clustering-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Silhouette coefficients of &lt; 0.25 suggest that structure is not meaningful; &gt; 0.5 denotes good evidence of clustering, and &gt; 0.7 strong evidence <span class="citation">(Kaufman &amp; Rousseeuw, 1990)</span>. The evidence for the visually apparent clustering is not as strong as it first appears. Let’s explore our two-cluster hierarchical clustering solution anyway.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="va">cluster</span> <span class="op">&lt;-</span> <span class="va">hClusters</span><span class="op">[[</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span></pre></div>
<p>We can visualize the clustering solution as a tree:</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">hTree</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'hclust'</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hTree</span>, labels <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="st">''</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">16</span>,
       col <span class="op">=</span> <span class="va">spectrum</span><span class="op">[</span><span class="va">hTree</span><span class="op">$</span><span class="va">order</span><span class="op">]</span><span class="op">)</span></pre></div>
<p><img src="treespace_files/figure-html/h-tree-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Another thing we may wish to do is to take the consensus of each cluster:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">col1</span> <span class="op">&lt;-</span> <span class="va">spectrum</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">treeNumbers</span><span class="op">[</span><span class="va">cluster</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">]</span>
<span class="va">col2</span> <span class="op">&lt;-</span> <span class="va">spectrum</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">treeNumbers</span><span class="op">[</span><span class="va">cluster</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">consensus</span><span class="op">(</span><span class="va">trees</span><span class="op">[</span><span class="va">cluster</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, edge.color <span class="op">=</span> <span class="va">col1</span>, edge.width <span class="op">=</span> <span class="fl">2</span>, tip.color <span class="op">=</span> <span class="va">col1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">consensus</span><span class="op">(</span><span class="va">trees</span><span class="op">[</span><span class="va">cluster</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, edge.color <span class="op">=</span> <span class="va">col2</span>, edge.width <span class="op">=</span> <span class="fl">2</span>, tip.color <span class="op">=</span> <span class="va">col2</span><span class="op">)</span></pre></div>
<p><img src="treespace_files/figure-html/consensus-1.png" width="700" style="display: block; margin: auto;"></p>
<p>In this case, we don’t learn much, though trees in one cluster are united by the position of <code>t7</code>.</p>
</div>
<div id="validating-a-projection" class="section level3">
<h3 class="hasAnchor">
<a href="#validating-a-projection" class="anchor"></a>Validating a projection</h3>
<p>Now let’s evaluate whether our plot of tree space is representative. First we want to know how many dimensions are necessary to adequately represent the true distances between trees. We hope for a trustworthiness × continuity score of &gt; 0.9 for a usable projection, or &gt; 0.95 for a good one.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="va">txc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">newDist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">projection</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="../reference/ProjectionQuality.html">ProjectionQuality</a></span><span class="op">(</span><span class="va">distances</span>, <span class="va">newDist</span>, <span class="fl">10</span><span class="op">)</span><span class="op">[</span><span class="st">'TxC'</span><span class="op">]</span>
<span class="op">}</span>, <span class="fl">0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">txc</span>, xlab <span class="op">=</span> <span class="st">'Dimension'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0.9</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></pre></div>
<p><img src="treespace_files/figure-html/how-many-dims-1.png" width="700" style="display: block; margin: auto;"></p>
<p>We are going to need at least five dimensions to adequately represent the distances between trees.</p>
<p>To help establish visually what structures are more likely to be genuine, we might also choose to calculate a minimum spanning tree:</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="va">mstEnds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/MSTEdges.html">MSTEdges</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span></pre></div>
<p>Let’s plot the first five dimensions of our tree space, highlighting the convex hulls of our clusters:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="va">plotSeq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">plotSeq</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">upper.tri</a></span><span class="op">(</span><span class="va">plotSeq</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">5</span> <span class="op">*</span> <span class="op">(</span><span class="fl">5</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">plotSeq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">plotSeq</span><span class="op">[</span><span class="op">-</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">plotSeq</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">11</span><span class="op">:</span><span class="fl">13</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span><span class="op">(</span><span class="va">plotSeq</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Set up blank plot</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">projection</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span>, <span class="va">projection</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, ann <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, frame.plot <span class="op">=</span> <span class="cn">TRUE</span>,
       type <span class="op">=</span> <span class="st">'n'</span>, asp <span class="op">=</span> <span class="fl">1</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">projection</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">projection</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># Plot MST</span>
  <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mstEnds</span>, <span class="fl">1</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">segment</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">projection</span><span class="op">[</span><span class="va">segment</span>, <span class="va">j</span><span class="op">]</span>, <span class="va">projection</span><span class="op">[</span><span class="va">segment</span>, <span class="va">i</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"#bbbbbb"</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># Add points</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">projection</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span>, <span class="va">projection</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="va">treeCols</span><span class="op">)</span>

  <span class="co"># Mark clusters</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">clI</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">inCluster</span> <span class="op">&lt;-</span> <span class="va">cluster</span> <span class="op">==</span> <span class="va">clI</span>
    <span class="va">clusterX</span> <span class="op">&lt;-</span> <span class="va">projection</span><span class="op">[</span><span class="va">inCluster</span>, <span class="va">j</span><span class="op">]</span>
    <span class="va">clusterY</span> <span class="op">&lt;-</span> <span class="va">projection</span><span class="op">[</span><span class="va">inCluster</span>, <span class="va">i</span><span class="op">]</span>
    <span class="va">hull</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/chull.html">chull</a></span><span class="op">(</span><span class="va">clusterX</span>, <span class="va">clusterY</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span><span class="va">clusterX</span><span class="op">[</span><span class="va">hull</span><span class="op">]</span>, <span class="va">clusterY</span><span class="op">[</span><span class="va">hull</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span>,
            border <span class="op">=</span> <span class="st">'#54de25bb'</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="co"># Annotate dimensions</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, type <span class="op">=</span> <span class="st">'n'</span>, ann <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="st">'Dimension 2'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, type <span class="op">=</span> <span class="st">'n'</span>, ann <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="st">'Dimension 3'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, type <span class="op">=</span> <span class="st">'n'</span>, ann <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="st">'Dimension 4'</span><span class="op">)</span></pre></div>
<p><img src="treespace_files/figure-html/plot-projection-5d-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Our clusters, so distinct in dimension 1, overlap strongly in every other dimension. The fact that the minimum spanning tree moves between clusters also underlines the fact that they are not as well defined as they appear by eye.</p>
<p>Note that cluster membership, as well as the precise shape of treespace, is a function of the tree distance metric. The phylogenetic information distance recovers a different pair of clusters, highlighting the dangers of interpreting a two-dimensional treespace plot:</p>
<p><img src="treespace_files/figure-html/pid-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Kaufman1990">
<p>Kaufman, L., &amp; Rousseeuw, P. J. (1990). Partitioning around medoids (Program PAM). In <em>Wiley Series in Probability and Statistics</em>. <em>Finding groups in data: An introduction to cluster analysis</em> (pp. 68–125). John Wiley &amp; Sons, Ltd. doi: <a href="https://doi.org/10.1002/9780470316801.ch2">10.1002/9780470316801.ch2</a></p>
</div>
<div id="ref-Kruskal1964">
<p>Kruskal, J. B. (1964). Multidimensional scaling by optimizing goodness of fit to a nonmetric hypothesis. <em>Psychometrika</em>, <em>29</em>(1), 1–27. doi: <a href="https://doi.org/10.1007/BF02289565">10.1007/BF02289565</a></p>
</div>
<div id="ref-Sammon1969">
<p>Sammon, J. (1969). A nonlinear mapping for data structure analysis. <em>IEEE Transactions on Computers</em>, <em>C-18</em>(5), 401–409. doi: <a href="https://doi.org/10.1109/T-C.1969.222678">10.1109/T-C.1969.222678</a></p>
</div>
<div id="ref-SmithDist">
<p>Smith, M. R. (2020). Information theoretic Generalized Robinson-Foulds metrics for comparing phylogenetic trees. <em>Bioinformatics</em>, online ahead of print. doi: <a href="https://doi.org/10.1093/bioinformatics/btaa614">10.1093/bioinformatics/btaa614</a></p>
</div>
<div id="ref-SmithSpace">
<p>Smith, M. R. (2021). The importance of methodology when analysing landscapes of phylogenetic trees. <em>Forthcoming</em>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://community.dur.ac.uk/martin.smith/">Martin R. Smith</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '8bf44d312479af73720c5ca5fcc12eba',
    indexName: 'treedist',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
