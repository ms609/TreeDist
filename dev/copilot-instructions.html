<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>TreeDist R Package Development • TreeDist</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="TreeDist R Package Development"><meta name="robots" content="noindex"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-BTKEG66D3F"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-BTKEG66D3F');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">TreeDist</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.9.2.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="articles/Using-TreeDist.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Function reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tree distance analysis</h6></li>
    <li><a class="dropdown-item" href="articles/Using-TreeDist.html">Calculate tree similarity with 'TreeDist'</a></li>
    <li><a class="dropdown-item" href="articles/using-distances.html">Contextualizing tree distances</a></li>
    <li><a class="dropdown-item" href="articles/different-leaves.html">Trees with different leaves</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tree space analysis</h6></li>
    <li><a class="dropdown-item" href="articles/treespace.html">Tree space analysis</a></li>
    <li><a class="dropdown-item" href="articles/landscapes.html">Analysing landscapes of phylogenetic trees</a></li>
    <li><a class="dropdown-item" href="articles/compare-treesets.html">Comparing sets of trees from different analyses</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tree distance introductions</h6></li>
    <li><a class="dropdown-item" href="articles/information.html">Comparing splits using information theory</a></li>
    <li><a class="dropdown-item" href="articles/Robinson-Foulds.html">Extending the Robinson-Foulds metric</a></li>
    <li><a class="dropdown-item" href="articles/Generalized-RF.html">Generalized Robinson-Foulds distances</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ms609/TreeDist"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>TreeDist R Package Development</h1>
      <small class="dont-index">Source: <a href="https://github.com/ms609/TreeDist/blob/main/.github/copilot-instructions.md" class="external-link"><code>.github/copilot-instructions.md</code></a></small>
    </div>

<div id="treedist-r-package-development" class="section level1">

<p>TreeDist is an R package providing efficient implementations of functions for the comparison of phylogenetic trees. It includes C++ code for performance, comprehensive testing, benchmarking infrastructure, and extensive CI/CD workflows. Correctness, speed and user-friendliness are priorities.</p>
<p>Always reference these instructions first and fallback to search or bash commands only when you encounter unexpected information that does not match the info here.</p>
<div class="section level2">
<h2 id="working-effectively">Working Effectively<a class="anchor" aria-label="anchor" href="#working-effectively"></a></h2>
<div class="section level3">
<h3 id="bootstrap-and-development-setup">Bootstrap and Development Setup<a class="anchor" aria-label="anchor" href="#bootstrap-and-development-setup"></a></h3>
<ul><li>
<p>Install R and development tools:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">sudo</span> apt update <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> apt install <span class="at">-y</span> r-base r-base-dev build-essential</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">-y</span> libcurl4-openssl-dev libssl-dev libxml2-dev libfontconfig1-dev libharfbuzz-dev libfribidi-dev</span></code></pre></div>
</li>
<li>
<p>Install R development packages:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">sudo</span> R <span class="at">-e</span> <span class="st">"install.packages(c('devtools', 'testthat', 'roxygen2', 'lintr'), repos='https://cran.r-project.org/')"</span></span></code></pre></div>
</li>
<li>
<p>Install TreeDist dependencies:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">sudo</span> R <span class="at">-e</span> <span class="st">"install.packages(c('ape', 'bit64', 'lifecycle', 'colorspace', 'fastmatch', 'RCurl', 'R.cache', 'Rdpack', 'stringi', 'PlotTools', 'TreeTools'), repos='https://cran.r-project.org/', dependencies=TRUE)"</span></span></code></pre></div>
</li>
</ul></div>
<div class="section level3">
<h3 id="building-and-checking">Building and Checking<a class="anchor" aria-label="anchor" href="#building-and-checking"></a></h3>
<ul><li><p><strong>NEVER CANCEL</strong>: R package builds can take 10-30+ minutes depending on dependencies and system performance. Set timeout to 60+ minutes.</p></li>
<li>
<p>Build the package:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">R</span> CMD build .</span></code></pre></div>
</li>
<li><p><strong>NEVER CANCEL</strong>: Full R CMD check takes 15-45+ minutes. Set timeout to 90+ minutes.</p></li>
<li>
<p>Check package (full validation):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">R</span> CMD check TreeDist_<span class="pp">*</span>.tar.gz</span></code></pre></div>
</li>
<li>
<p>Quick check (development, ~2-5 minutes):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">R</span> CMD check <span class="at">--no-build-vignettes</span> <span class="at">--no-manual</span> .</span></code></pre></div>
</li>
</ul></div>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h3>
<ul><li><p><strong>NEVER CANCEL</strong>: Test suite has 61+ test files and can take 10-30+ minutes. Set timeout to 60+ minutes.</p></li>
<li>
<p>Run all tests:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"devtools::test()"</span></span></code></pre></div>
</li>
<li>
<p>Run tests with testthat directly:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"testthat::test_dir('tests/testthat')"</span></span></code></pre></div>
</li>
<li>
<p>Run specific test file:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"testthat::test_file('tests/testthat/test-tree_display.R')"</span></span></code></pre></div>
</li>
</ul></div>
<div class="section level3">
<h3 id="development-workflow-commands">Development Workflow Commands<a class="anchor" aria-label="anchor" href="#development-workflow-commands"></a></h3>
<ul><li>
<p>Load package for development:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"devtools::load_all()"</span></span></code></pre></div>
</li>
<li>
<p>Check code style (~1-2 minutes):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"lintr::lint_dir('.')"</span></span></code></pre></div>
</li>
<li>
<p>Build documentation:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"devtools::document()"</span></span></code></pre></div>
</li>
<li><p><strong>NEVER CANCEL</strong>: Build vignettes takes 5-15+ minutes. Set timeout to 30+ minutes.</p></li>
<li>
<p>Build vignettes:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"devtools::build_vignettes(install = FALSE)"</span></span></code></pre></div>
</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="validation">Validation<a class="anchor" aria-label="anchor" href="#validation"></a></h2>
<p><strong>CRITICAL: Always run the full test suite before proposing changes</strong> <code>bash   R -e "devtools::test()"</code></p>
<ul><li><p>Always run R CMD check for complete validation before finalizing changes.</p></li>
<li><p>ALWAYS run the full test suite when modifying C++ code in src/ directory.</p></li>
<li><p>ALWAYS run lintr to ensure code style compliance before committing.</p></li>
<li>
<p>For performance-critical changes, run benchmarks in benchmark/ directory:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"source('benchmark/_run_benchmarks.R')"</span></span></code></pre></div>
</li>
<li>
<p>Memory checking is available but optional (takes significant time):</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-d</span> <span class="st">"valgrind --tool=memcheck --leak-check=full"</span> <span class="at">--vanilla</span> <span class="op">&lt;</span> memcheck/tests.R</span></code></pre></div>
</li>
</ul></div>
<div class="section level2">
<h2 id="validation-scenarios">Validation Scenarios<a class="anchor" aria-label="anchor" href="#validation-scenarios"></a></h2>
<p>After making code changes, validate functionality by testing core phylogenetic tree operations:</p>
</div>
<div class="section level2">
<h2 id="time-expectations--critical-warnings">Time Expectations &amp; Critical Warnings<a class="anchor" aria-label="anchor" href="#time-expectations--critical-warnings"></a></h2>
<ul><li>
<strong>R startup</strong>: ~0.1 seconds</li>
<li>
<strong>Linting</strong>: 1-3 minutes for full codebase</li>
<li>
<strong>Quick check</strong> (no vignettes/manual): 2-5 minutes<br></li>
<li>
<strong>Documentation building</strong>: 2-5 minutes</li>
<li>
<strong>Test suite</strong>: 10-30+ minutes (NEVER CANCEL - set 60+ minute timeout)</li>
<li>
<strong>Full R CMD check</strong>: 15-45+ minutes (NEVER CANCEL - set 90+ minute timeout)</li>
<li>
<strong>Package build</strong>: 10-30+ minutes (NEVER CANCEL - set 60+ minute timeout)</li>
<li>
<strong>Vignette building</strong>: 5-15+ minutes (NEVER CANCEL - set 30+ minute timeout)</li>
<li>
<strong>Benchmarks</strong>: 5-20+ minutes (NEVER CANCEL - set 30+ minute timeout)</li>
</ul></div>
<div class="section level2">
<h2 id="repository-structure">Repository Structure<a class="anchor" aria-label="anchor" href="#repository-structure"></a></h2>
<div class="section level3">
<h3 id="key-directories">Key Directories<a class="anchor" aria-label="anchor" href="#key-directories"></a></h3>
<ul><li>
<code>R/</code> - R source code (59 R files with 500+ exported functions)</li>
<li>
<code>src/</code> - C++ source code requiring compilation (17 C++ files, SystemRequirements: C++17)</li>
<li>
<code>tests/testthat/</code> - Test suite (61+ test files)</li>
<li>
<code>benchmark/</code> - Performance benchmarking (10+ benchmark files)<br></li>
<li>
<code>man/</code> - Generated documentation (do not edit manually)</li>
<li>
<code>vignettes/</code> - Package tutorials and documentation</li>
<li>
<code>data/</code> - Package data files</li>
<li>
<code>.github/workflows/</code> - Extensive CI/CD with R-CMD-check, benchmarks, memory checks</li>
</ul></div>
<div class="section level3">
<h3 id="important-files">Important Files<a class="anchor" aria-label="anchor" href="#important-files"></a></h3>
<ul><li>
<code>DESCRIPTION</code> - Package metadata, dependencies, and system requirements</li>
<li>
<code>NAMESPACE</code> - Generated by roxygen2 (do not edit manually)</li>
<li>
<code>.lintr</code> - Code style configuration (follows Google R style guide)</li>
<li>
<code>NEWS.md</code> - Version history (update for user-facing changes)</li>
<li>
<code>tests/testthat.R</code> - Test runner entry point</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="common-tasks">Common Tasks<a class="anchor" aria-label="anchor" href="#common-tasks"></a></h2>
<div class="section level3">
<h3 id="after-making-changes">After Making Changes<a class="anchor" aria-label="anchor" href="#after-making-changes"></a></h3>
<ol style="list-style-type: decimal"><li>
<p>Load and test changes interactively:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"devtools::load_all(); # test your changes interactively"</span></span></code></pre></div>
</li>
<li>
<p>Run linting:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"lintr::lint_dir('.')"</span></span></code></pre></div>
</li>
<li>
<p>Run relevant tests:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"devtools::test()"</span></span></code></pre></div>
</li>
<li>
<p>For C++ changes, always run full check:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">R</span> CMD check <span class="at">--no-build-vignettes</span> .</span></code></pre></div>
</li>
</ol></div>
<div class="section level3">
<h3 id="code-style-guidelines">Code Style Guidelines<a class="anchor" aria-label="anchor" href="#code-style-guidelines"></a></h3>
<ul><li>Follow Google’s R style guide</li>
<li>Use camelCase for variable names, TitleCase for function names<br></li>
<li>Use Oxford ending ‘ize’ (not ‘ise’) and UK spelling where applicable</li>
<li>Document functions with roxygen2 comments</li>
<li>Include test cases for new functionality</li>
</ul></div>
<div class="section level3">
<h3 id="ci-will-fail-if">CI Will Fail If<a class="anchor" aria-label="anchor" href="#ci-will-fail-if"></a></h3>
<ul><li>R CMD check fails</li>
<li>Tests fail<br></li>
<li>Code style violations (lintr)</li>
<li>Missing or inadequate documentation</li>
<li>Missing test coverage for new code</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a></h2>
<ul><li>If package won’t build: check that all system dependencies are installed</li>
<li>If tests fail after C++ changes: rebuild package completely</li>
<li>If documentation is missing: run <code>devtools::document()</code>
</li>
<li>If benchmarks fail: performance regressions may need investigation</li>
<li>Memory issues: use valgrind checking for C++ code validation</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://smithlabdurham.github.io/" class="external-link">Martin R. Smith</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer></div>





  </body></html>

