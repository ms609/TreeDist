---
title: "Using TreeDist to calculate tree similarity"
author: "Martin R. Smith"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
bibliography: ../inst/REFERENCES.bib
csl: ../inst/apa-old-doi-prefix.csl
vignette: >
  %\VignetteIndexEntry{Using TreeDist}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Loading trees

Instructions for loading phylogenetic trees into R can be found in a [separate vignette](https://ms609.github.io/TreeSearch/TODO-TO-BE-CONFIRMED). #TODO check link
For these examples, we'll enter two simple trees by hand:

```{r set-up}
tree1 <- ape::read.tree(text='(A, ((B, ((C, D), (E, F))), (G, ((H, I), (J, K)))));')
tree2 <- ape::read.tree(text='(A, ((B, ((C, D), (E, (J, K)))), (G, ((H, I), F))));')
```

# Calculating distances

We can calculate distances between pairs of trees using the `TreeDist` package.  
First we'll install the package:

```r
install.packages('TreeDist')
```

Or we can install a development version:

```r 
devtools::install_github('ms609/TreeDist')
```

Then we'll load the package in to R's working environment:

```{r laod-package}
library('TreeDist')
```

Now the distance functions are available, and we can calculate distances.

## Pairs of trees

Calculating the distance between two trees is as simple as:

```{r measure-distance}
distance <- TreeDistance(tree1, tree2)
```

The convenience function `TreeDistance` returns the variation of clustering
information between two trees, normalized against the total information content 
of all partitions.
For more on different tree distance metrics, see the
[tree distance vignette](./tree-distances.html). #TODO check link

## Visualizing the matching

Generalized Robinson-Foulds metrics, such as the variation of clustering
information, rely on matching each split within a tree with another split in the
other tree.
We can view an optimal matching:

```{r visualise-matching}
VisualizeMatching(VariationOfClusteringInfo, tree1, tree2)
```

This shows the eight splits in tree 1, and the paired splits in tree two.  
Each split is labelled with a measure of its similarity, which is its contribution 
to the total tree distance score.

We can view this information in a format accessible for further examination in R with:

```{r write-vis-matching}
VariationOfClusteringInfo(tree1, tree2, reportMatching = TRUE)
```

Here, the `pairScores` attribute lists the score of each possible matching of splits.

We can identify the splits with:

```{r}
splits <- IdentifySplits(TreeSearch::Tree2Splits(tree2))
splits
```

The names of the splits correspond to the number of the nodes in the original tree:

```{r}
plot(tree2)
ape::nodelabels()
ape::nodelabels(splits, as.integer(names(splits)), 
                adj=c(1.1, -0.2), cex=0.8, frame='none')
```

## Normalizing


## Lists of trees

- Multiphylo

- List

## Testing similarity to a known tree

- The precision/accuracy distinction

- The role of information

- A ternary plotting approach

# References
